{
  "hooks": {
    "UserPromptSubmit": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'SCRIPT=\"${CLAUDE_PLUGIN_ROOT:-}/hooks/scripts/check-rag-config.sh\"; [ -x \"$SCRIPT\" ] && \"$SCRIPT\" || echo \"{\\\"rag_enabled\\\": false, \\\"reason\\\": \\\"script_not_found\\\"}\"'",
            "onError": "ignore"
          },
          {
            "type": "prompt",
            "prompt": "Check the previous command's output for RAG configuration.\n\nIF output shows 'rag_enabled': true:\n1. Extract the user's question/request from their message\n2. Search the knowledge stash using the Chroma MCP tools (chroma_query_documents on collection 'code-crib' or 'code-crib-{project}')\n3. If relevant results found (distance < 0.3), prepend context:\n   '[RAG Context] Found relevant knowledge:\\n[summary of top 3 results]\\n---\\n'\n4. Continue processing the user's request with this context\n\nIF output shows 'rag_enabled': false, OR no output, OR command failed:\n- Do nothing, process the user's message normally without RAG\n\nIMPORTANT: This should be fast and silent. Don't announce RAG lookups unless results are found. If anything fails, just continue without RAG."
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Analyze this session for documentation-worthy work and auto-save if significant:\n\n## Significance Criteria (check any):\n- Code files were modified (Edit/Write tool used)\n- Bug was diagnosed and fixed\n- New feature was implemented\n- Architecture decision was made or documented\n\n## Auto-Save Rules:\n\n**IF significant work detected:**\n1. Automatically invoke the /stash command (or /save)\n2. Let the documenter agent generate the document\n3. Report to user: 'Session auto-documented: [title]'\n\n**IF no significant work (skip silently):**\n- Only file reads occurred\n- Only questions/answers without code changes\n- Only exploration/analysis without conclusions\n\n## Threshold Examples:\n| Session Activity | Action |\n|------------------|--------|\n| Fixed a bug with code edit | AUTO-SAVE |\n| Implemented new feature | AUTO-SAVE |\n| Refactored code structure | AUTO-SAVE |\n| Just read files for context | SKIP |\n| Asked questions, got explanations | SKIP |\n| Explored codebase without changes | SKIP |\n\nBe intelligent: if the user explicitly said 'fixed', 'solved', 'implemented', 'completed' - that's significant work worth documenting."
          }
        ]
      }
    ]
  }
}
