{
  "hooks": {
    "UserPromptSubmit": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "AUTO-RAG: Search knowledge stash and inject relevant context.\n\n## Quick Check - SKIP if:\n- Prompt is < 10 chars\n- Prompt starts with '/' (meta command)\n- Prompt is just greeting (hi, hello, thanks)\n- Prompt contains 'no rag' or 'skip rag'\n\n## If NOT skipped:\n\n### 1. Read Config\nRead `code-crib.local.md` in plugin directory. If `auto_rag.enabled` is false or missing, SKIP.\n\n### 2. Extract Query\nFrom user prompt, extract 3-5 key technical terms:\n- Error names/codes\n- Function/class names\n- Technical concepts\n- Action + object pairs\n\n### 3. Search Vector DB\nUse config to determine backend:\n\n**Chroma**: `chroma_query_documents` with collection from config, n_results: 3\n**Pinecone**: `search-records` with TopK: 3\n\n### 4. Inject Context (if results found)\nPrepend to your mental context (don't output this directly):\n\n```\n<rag-context>\nRelevant from past work:\n- {title}: {key_insight} ({date})\n</rag-context>\n```\n\nThen naturally reference in your response:\n- 'Based on your previous work on X...'\n- 'This is similar to the Y issue you solved...'\n\n### 5. No Results = Proceed Normally\nDon't mention 'no results found'. Just respond naturally."
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Analyze this session for documentation-worthy work and auto-save if significant:\n\n## Significance Criteria (check any):\n- Code files were modified (Edit/Write tool used)\n- Bug was diagnosed and fixed\n- New feature was implemented\n- Architecture decision was made or documented\n\n## Auto-Save Rules:\n\n**IF significant work detected:**\n1. Automatically invoke the /stash command (or /save)\n2. Let the documenter agent generate the document\n3. Report to user: 'Session auto-documented: [title]'\n\n**IF no significant work (skip silently):**\n- Only file reads occurred\n- Only questions/answers without code changes\n- Only exploration/analysis without conclusions\n\n## Threshold Examples:\n| Session Activity | Action |\n|------------------|--------|\n| Fixed a bug with code edit | AUTO-SAVE |\n| Implemented new feature | AUTO-SAVE |\n| Refactored code structure | AUTO-SAVE |\n| Just read files for context | SKIP |\n| Asked questions, got explanations | SKIP |\n| Explored codebase without changes | SKIP |\n\nBe intelligent: if the user explicitly said 'fixed', 'solved', 'implemented', 'completed' - that's significant work worth documenting."
          }
        ]
      }
    ]
  }
}
